(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5498],{7401:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/database",function(){return r(9826)}])},9826:function(e,s,r){"use strict";r.r(s),r.d(s,{__toc:function(){return k}});var i=r(5893),l=r(2673),n=r(5417),o=r(3209);r(4759);var t=r(2643),a=r(8757),c=r(208),h=r(5675),d=r.n(h);let x=e=>{let{children:s}=e,r=Object.assign({div:"div"},(0,t.a)());return(0,i.jsx)(r.div,{className:"max-w-screen-xl mx-auto px-4 py-8",children:s})},k=[{depth:2,value:"Database Architecture",id:"database-architecture"},{depth:2,value:"Schema Diagram",id:"schema-diagram"},{depth:2,value:"Core Tables",id:"core-tables"},{depth:3,value:"Users Table",id:"users-table"},{depth:3,value:"Conversations Table",id:"conversations-table"},{depth:3,value:"Participants Table",id:"participants-table"},{depth:3,value:"Messages Table",id:"messages-table"},{depth:3,value:"Media Table",id:"media-table"},{depth:2,value:"Partitioning Strategy",id:"partitioning-strategy"},{depth:2,value:"Indexing Strategy",id:"indexing-strategy"},{depth:2,value:"Data Access Patterns",id:"data-access-patterns"},{depth:2,value:"Backup and Replication",id:"backup-and-replication"},{depth:2,value:"Database Scaling",id:"database-scaling"},{depth:2,value:"Redis",id:"redis"}];function p(e){let s=Object.assign({h1:"h1",p:"p",h2:"h2",ul:"ul",li:"li",h3:"h3",code:"code",pre:"pre",span:"span",ol:"ol",strong:"strong",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,t.a)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{children:"Database Design"}),"\n",(0,i.jsx)(c.UW,{type:"info",children:(0,i.jsx)(s.p,{children:"This section outlines the database architecture that powers Whisper Chat,\nincluding table structures, relationships, and optimization strategies."})}),"\n",(0,i.jsx)(s.h2,{id:"database-architecture",children:"Database Architecture"}),"\n",(0,i.jsx)(s.p,{children:"Whisper uses a PostgreSQL database with specialized extensions to handle the unique requirements of a real-time messaging platform. The database is designed to optimize for:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"High read/write throughput"}),"\n",(0,i.jsx)(s.li,{children:"Low-latency queries"}),"\n",(0,i.jsx)(s.li,{children:"Data integrity and consistency"}),"\n",(0,i.jsx)(s.li,{children:"Efficient search capabilities"}),"\n",(0,i.jsx)(s.li,{children:"Scalability for millions of users and messages"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"schema-diagram",children:"Schema Diagram"}),"\n",(0,i.jsx)(s.p,{children:"The following diagram illustrates the relationships between the main entities in Whisper's database:"}),"\n",(0,i.jsx)("div",{className:"my-10 border rounded-lg overflow-hidden shadow-md",children:(0,i.jsx)(d(),{src:"https://pub-cc2ebc8a43754210aa734d07c4898ad1.r2.dev/2025/06/Diagram%201.webp",alt:"Whisper Database Schema Diagram",width:1e3,height:700,className:"w-full object-cover"})}),"\n",(0,i.jsx)(s.h2,{id:"core-tables",children:"Core Tables"}),"\n",(0,i.jsx)(s.h3,{id:"users-table",children:"Users Table"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"users"})," table stores essential information about Whisper users:"]}),"\n",(0,i.jsx)(s.pre,{"data-language":"sql","data-theme":"default",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"users"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  user_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PRIMARY KEY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  username "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"64"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"UNIQUE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  email "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"255"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"UNIQUE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  display_name "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"128"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  profile_picture_url "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TEXT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"status"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"64"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'offline'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  last_seen "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  created_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOW"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  updated_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOW"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_users_username"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" users(username);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_users_status"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" users("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"status"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]})]})}),"\n",(0,i.jsx)(s.h3,{id:"conversations-table",children:"Conversations Table"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"conversations"})," table represents chat conversations, which can be either direct (between two users) or groups:"]}),"\n",(0,i.jsx)(s.pre,{"data-language":"sql","data-theme":"default",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"conversations"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  conversation_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PRIMARY KEY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  conversation_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"16"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CHECK"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (conversation_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"IN"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'direct'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'group'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  title "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"128"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  created_by UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" users(user_id),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  created_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOW"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  updated_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOW"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_conversations_type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" conversations(conversation_type);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_conversations_created_by"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" conversations(created_by);"})]})]})}),"\n",(0,i.jsx)(s.h3,{id:"participants-table",children:"Participants Table"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"participants"})," table manages the relationship between users and conversations:"]}),"\n",(0,i.jsx)(s.pre,{"data-language":"sql","data-theme":"default",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"participants"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  participant_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PRIMARY KEY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  user_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" users(user_id),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  conversation_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" conversations(conversation_id),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"role"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"16"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'member'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CHECK"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"role"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"IN"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'admin'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'member'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  joined_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOW"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(),"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  last_read_message_id UUID,"})}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"UNIQUE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(user_id, conversation_id)"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_participants_user"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" participants(user_id);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_participants_conversation"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" participants(conversation_id);"})]})]})}),"\n",(0,i.jsx)(s.h3,{id:"messages-table",children:"Messages Table"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"messages"})," table stores all messages sent within the platform:"]}),"\n",(0,i.jsx)(s.pre,{"data-language":"sql","data-theme":"default",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"messages"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  message_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PRIMARY KEY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  conversation_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" conversations(conversation_id),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  sender_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" users(user_id),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  message_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"16"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CHECK"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (message_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"IN"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'text'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'media'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'system'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  content "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TEXT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"encrypted"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BOOLEAN"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" TRUE,"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  sent_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"DEFAULT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOW"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  edited_at "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TIMESTAMP WITH TIME ZONE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  parent_message_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" messages(message_id)"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_messages_conversation"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" messages(conversation_id);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_messages_sender"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" messages(sender_id);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_messages_sent_at"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" messages(sent_at);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_messages_parent"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" messages(parent_message_id);"})]})]})}),"\n",(0,i.jsx)(s.h3,{id:"media-table",children:"Media Table"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"media"})," table stores information about media files shared in messages:"]}),"\n",(0,i.jsx)(s.pre,{"data-language":"sql","data-theme":"default",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"media"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  media_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PRIMARY KEY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  message_id UUID "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"REFERENCES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" messages(message_id),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  media_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"16"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CHECK"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (media_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"IN"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'image'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'video'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'audio'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'document'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")),"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  file_name "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"255"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  file_size "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BIGINT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  mime_type "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VARCHAR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"128"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  storage_path "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TEXT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT NULL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  thumbnail_path "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TEXT"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  metadata JSONB"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_media_message"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" media(message_id);"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INDEX"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"idx_media_type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" media(media_type);"})]})]})}),"\n",(0,i.jsx)(s.h2,{id:"partitioning-strategy",children:"Partitioning Strategy"}),"\n",(0,i.jsx)(s.p,{children:"For high-scale deployments, Whisper implements table partitioning to improve query performance and maintenance operations:"}),"\n",(0,i.jsx)(c.UW,{type:"info",children:(0,i.jsx)(s.p,{children:"Messages are partitioned by date range (monthly), enabling efficient\narchiving and query optimization."})}),"\n",(0,i.jsx)(s.pre,{"data-language":"sql","data-theme":"default",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Example of message table partitioning"})}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"messages"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- columns as defined above"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PARTITION"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"RANGE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (sent_at);"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Create monthly partitions"})}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"messages_y2023m01"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PARTITION"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" OF messages"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FOR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VALUES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'2023-01-01'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TO"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'2023-02-01'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"CREATE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TABLE"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"messages_y2023m02"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PARTITION"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" OF messages"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FOR"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"VALUES"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'2023-02-01'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TO"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'2023-03-01'"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:" "}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Additional partitions as needed"})})]})}),"\n",(0,i.jsx)(s.h2,{id:"indexing-strategy",children:"Indexing Strategy"}),"\n",(0,i.jsx)(s.p,{children:"Whisper employs a comprehensive indexing strategy to ensure optimal query performance:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Primary Key Indices"}),": All tables have UUID primary keys"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Foreign Key Indices"}),": All foreign key columns are indexed"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Compound Indices"}),": Created for frequently used query patterns"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Partial Indices"}),": Used for filtering on common conditions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"GIN Indices"}),": Used for JSONB and full-text search columns"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"data-access-patterns",children:"Data Access Patterns"}),"\n",(0,i.jsx)(s.p,{children:"The database design is optimized for these common data access patterns:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Access Pattern"}),(0,i.jsx)(s.th,{children:"Implementation"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Retrieve recent messages"}),(0,i.jsxs)(s.td,{children:["Index on ",(0,i.jsx)(s.code,{children:"(conversation_id, sent_at DESC)"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Search message content"}),(0,i.jsx)(s.td,{children:"Full-text search with GIN index"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"User conversation list"}),(0,i.jsx)(s.td,{children:"Join between users, participants, and conversations"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Unread message count"}),(0,i.jsx)(s.td,{children:"Comparison between last_read_message_id and latest message"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Media gallery view"}),(0,i.jsxs)(s.td,{children:["Index on ",(0,i.jsx)(s.code,{children:"(conversation_id, media_type)"})]})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"backup-and-replication",children:"Backup and Replication"}),"\n",(0,i.jsx)(s.p,{children:"To ensure data durability and availability, Whisper employs:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Continuous archiving with Point-in-Time Recovery (PITR)"}),"\n",(0,i.jsx)(s.li,{children:"Synchronous replication to standby servers"}),"\n",(0,i.jsx)(s.li,{children:"Daily full backups with 30-day retention"}),"\n",(0,i.jsx)(s.li,{children:"Cross-region backup storage"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"database-scaling",children:"Database Scaling"}),"\n",(0,i.jsx)(s.p,{children:"As user base grows, Whisper's database scales through:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Read Replicas"}),": For distributing read queries"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sharding"}),": Horizontal partitioning by user geography or conversation ID"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Connection Pooling"}),": Efficient management of database connections"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Query Optimization"}),": Regular query plan analysis and optimization"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Caching"}),": Implementing Redis for frequently accessed data"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"redis",children:"Redis"}),"\n",(0,i.jsx)(a.G,{chart:'flowchart LR\n subgraph s1["底层存储"]\n        T[("SQLite Database<br>持久化存储")]\n        U[("Redis Cache<br>内存缓存")]\n  end\n    A["Server API Handler"] --> B{"操作类型判断"}\n    B -- 读操作 --> C["Redis缓存查询"]\n    C -- 缓存命中 --> F["直接返回缓存数据"]\n    B -- 写操作 --> D["SQLite数据库写入"]\n    C -- 缓存未命中 --> G["查询SQLite数据库"]\n    H["更新Redis缓存"] --> I["返回数据库结果"] & U\n    D --> J["更新Redis缓存"] & T\n    J --> K["返回写入结果"] & U\n    L["清除Redis缓存"] --> M["返回删除结果"] & U\n    B -- 删除操作 --> E["SQLite数据库删除"]\n    G --> H & T\n    E --> L & T\n    C --> U\n     T:::database\n     U:::cache\n     C:::readOp\n     F:::readOp\n     D:::writeOp\n     G:::readOp\n     H:::readOp\n     I:::readOp\n     J:::writeOp\n     K:::writeOp\n     L:::deleteOp\n     M:::deleteOp\n     E:::deleteOp\n    classDef readOp fill:#e1f5fe,stroke:#0277bd,stroke-width:2px\n    classDef writeOp fill:#fff3e0,stroke:#ef6c00,stroke-width:2px\n    classDef deleteOp fill:#fce4ec,stroke:#c2185b,stroke-width:2px\n    classDef cache fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px\n    classDef database fill:#e8f5e8,stroke:#388e3c,stroke-width:2px'}),"\n","\n",(0,i.jsx)(s.p,{children:";"})]})}let y={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.jsx)(x,{...e,children:(0,i.jsx)(p,{...e})})},pageOpts:{filePath:"pages/database.mdx",route:"/database",timestamp:1749055448e3,pageMap:[{kind:"Meta",data:{index:{title:"Introduction",type:"page",display:"hidden"},demo:{title:"Demo & Introduction",type:"page"},protocol:{title:"Protocol",type:"page"},sequence:{title:"Sequence Flow",type:"page"},database:{title:"Database Design",type:"page"},uml:{title:"UML Structure",type:"page"},"stress-test":{title:"Stress Testing",type:"page",display:"hidden"}}},{kind:"MdxPage",name:"database",route:"/database"},{kind:"MdxPage",name:"demo",route:"/demo"},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"protocol",route:"/protocol",children:[{kind:"Meta",data:{index:{title:"Protocol Overview",type:"page"},authentication:{title:"Authentication",type:"page"},private_chat:{title:"Private Chat",type:"page"},group_chat:{title:"Group Chat",type:"page"},presence:"Presence"}},{kind:"MdxPage",name:"authentication",route:"/protocol/authentication"},{kind:"MdxPage",name:"group_chat",route:"/protocol/group_chat"},{kind:"MdxPage",name:"index",route:"/protocol"},{kind:"MdxPage",name:"presence",route:"/protocol/presence"},{kind:"MdxPage",name:"private_chat",route:"/protocol/private_chat"}]},{kind:"MdxPage",name:"sequence",route:"/sequence"},{kind:"Folder",name:"sequences",route:"/sequences",children:[{kind:"MdxPage",name:"authentication",route:"/sequences/authentication"},{kind:"MdxPage",name:"group_chat",route:"/sequences/group_chat"},{kind:"MdxPage",name:"presence",route:"/sequences/presence"},{kind:"MdxPage",name:"private_chat",route:"/sequences/private_chat"},{kind:"Meta",data:{authentication:"Authentication",group_chat:"Group Chat",presence:"Presence",private_chat:"Private Chat"}}]},{kind:"MdxPage",name:"stress-test",route:"/stress-test"},{kind:"MdxPage",name:"uml",route:"/uml"}],flexsearch:{codeblocks:!0},readingTime:{text:"4 min read",minutes:3.17,time:190200,words:634},title:"Database Design",headings:k},pageNextRoute:"/database",nextraLayout:n.ZP,themeConfig:o.Z};s.default=(0,l.j)(y)},3209:function(e,s,r){"use strict";var i=r(5893),l=r(7656),n=r(1163);let o={logo:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(l.Z,{size:24,className:"mr-2"}),(0,i.jsx)("span",{className:"font-bold text-xl",children:"Whisper Chat"})]}),project:{link:"https://github.com/ukeSJTU/whisper"},docsRepositoryBase:"https://github.com/ukeSJTU/whisper-docs",footer:{text:(0,i.jsxs)("span",{children:["\xa9 ",new Date().getFullYear()," Whisper Chat. All rights reserved."]})},useNextSeoProps(){let{asPath:e}=(0,n.useRouter)();return{titleTemplate:"/"!==e?"%s – Whisper Chat":"Whisper Chat - Secure Real-Time Communication",description:"Whisper is a modern, secure web-based chat application for real-time communication."}},head:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,i.jsx)("meta",{name:"description",content:"Whisper is a modern, secure web-based chat application for real-time communication."}),(0,i.jsx)("meta",{name:"og:title",content:"Whisper Chat"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),banner:{key:"whisper-release",text:(0,i.jsxs)("span",{children:["\uD83C\uDF89 Try Whisper Chat online →"," ",(0,i.jsx)("a",{href:"https://whisper.ukehome.top",children:"whisper"})]})},primaryHue:{dark:260,light:180},navigation:{prev:!0,next:!0},darkMode:!0,nextThemes:{defaultTheme:"system"}};s.Z=o},5789:function(){},8757:function(e,s,r){"use strict";r.d(s,{G:function(){return o}});var i=r(5893),l=r(7294),n=r(7541);function o({chart:e}){let s=(0,l.useId)(),[r,o]=(0,l.useState)("");return(0,l.useEffect)(()=>{let r=document.documentElement,i=new MutationObserver(l);return i.observe(r,{attributes:!0}),l(),()=>{i.disconnect()};async function l(){let i=r.classList.contains("dark")||r.attributes.getNamedItem("data-theme")?.value==="dark";try{n.N.initialize({startOnLoad:!1,securityLevel:"loose",fontFamily:"inherit",themeCSS:"margin: 1.5rem auto 0;",theme:i?"dark":"default"});let{svg:r}=await n.N.render(s.replaceAll(":",""),e);o(r)}catch(e){console.error("Error while rendering mermaid",e)}}},[e]),(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:r}})}}},function(e){e.O(0,[7163,2114,3542,2888,9774,179],function(){return e(e.s=7401)}),_N_E=e.O()}]);