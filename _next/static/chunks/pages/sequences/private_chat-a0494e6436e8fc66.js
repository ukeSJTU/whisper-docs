(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6620],{3785:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sequences/private_chat",function(){return t(1663)}])},1663:function(e,r,t){"use strict";t.r(r),t.d(r,{__toc:function(){return l}});var a=t(5893),n=t(2673),i=t(5417),s=t(3209);t(4759);var d=t(2643),c=t(8757);let l=[];function o(e){return(0,a.jsx)(c.G,{chart:"sequenceDiagram\n    participant SenderApp as Sender Application\n    participant SenderService as Sender PrivateChatService\n    participant SenderHandler as Sender PrivateChatHandler\n    participant ServerHandler as Server PrivateChatHandler\n    participant ServerStorage as Server Storage\n    participant ReceiverHandler as Receiver PrivateChatHandler\n    participant ReceiverApp as Receiver Application\n\n    Note over SenderApp, ReceiverApp: Private Chat Message Exchange\n\n    Note over SenderApp, ReceiverApp: Sending Private Message\n    SenderApp->>SenderService: send_private_chat_message(recipient_id, message)\n    SenderService->>SenderApp: Update UI (optimistic message display)\n    SenderService->>ServerHandler: SEND_PRIVATE_CHAT_MESSAGE_REQUEST (recipient_user_id, content, client_message_id)\n    ServerHandler->>ServerStorage: create_private_chat_message(sender_user_id, recipient_user_id, content)\n    ServerStorage-->>ServerHandler: saved message\n\n    alt Sending Success\n        ServerHandler-->>SenderService: PRIVATE_CHAT_MESSAGE_SENT_ACK (status_message, server_message_id, client_message_id, message_timestamp)\n        SenderService->>SenderHandler: handle_private_chat_message_sent_ack(message)\n        SenderHandler->>SenderApp: Update UI (message delivery status)\n\n        alt Recipient Online\n            ServerHandler->>ReceiverHandler: RECEIVE_PRIVATE_CHAT_MESSAGE_NOTIFICATION (server_message_id, sender_user_id, sender_username, content, message_timestamp)\n            ReceiverHandler->>ReceiverApp: Update UI (new message received)\n        else Recipient Offline\n            Note over ServerHandler, ReceiverHandler: Message stored for later delivery\n        end\n    else Sending Failure\n        ServerHandler-->>SenderService: ERROR_RESPONSE (error_code, error_message)\n        SenderService->>SenderHandler: handle_error_response(message)\n        SenderHandler->>SenderApp: Update UI (message delivery failed)\n    end\n\n    Note over SenderApp, ReceiverApp: Recalling Private Message\n    SenderApp->>SenderService: recall_private_chat_message(recipient_id, server_message_id)\n    SenderService->>ServerHandler: RECALL_PRIVATE_CHAT_MESSAGE_REQUEST (recipient_user_id, server_message_id_to_recall, client_recall_request_id?)\n    ServerHandler->>ServerStorage: delete_private_chat_message(message_id)\n    ServerStorage-->>ServerHandler: success or failure\n\n    alt Recall Success\n        ServerHandler-->>SenderService: PRIVATE_CHAT_MESSAGE_RECALLED_ACK (status=true, status_message, recalled_server_message_id, client_recall_request_id?)\n        SenderService->>SenderHandler: handle_private_chat_message_recall_ack(message)\n        SenderHandler->>SenderApp: Update UI (message recalled)\n\n        alt Recipient Online\n            ServerHandler->>ReceiverHandler: RECEIVE_PRIVATE_CHAT_MESSAGE_RECALL_NOTIFICATION (server_message_id_to_recall, recalled_by_user_id, chat_partner_user_id, recall_timestamp)\n            ReceiverHandler->>ReceiverApp: Update UI (message marked as recalled)\n        end\n    else Recall Failure\n        ServerHandler-->>SenderService: PRIVATE_CHAT_MESSAGE_RECALLED_ACK (status=false, status_message, recalled_server_message_id, client_recall_request_id?)\n        SenderService->>SenderHandler: handle_private_chat_message_recall_ack(message)\n        SenderHandler->>SenderApp: Update UI (message recall failed)\n    end"})}let p={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,d.a)(),e.components);return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(o,{...e})}):o(e)},pageOpts:{filePath:"pages/sequences/private_chat.md",route:"/sequences/private_chat",timestamp:1749055448e3,pageMap:[{kind:"Meta",data:{index:{title:"Introduction",type:"page",display:"hidden"},demo:{title:"Demo & Introduction",type:"page"},protocol:{title:"Protocol",type:"page"},sequence:{title:"Sequence Flow",type:"page"},database:{title:"Database Design",type:"page"},uml:{title:"UML Structure",type:"page"},"stress-test":{title:"Stress Testing",type:"page",display:"hidden"}}},{kind:"MdxPage",name:"database",route:"/database"},{kind:"MdxPage",name:"demo",route:"/demo"},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"protocol",route:"/protocol",children:[{kind:"Meta",data:{index:{title:"Protocol Overview",type:"page"},authentication:{title:"Authentication",type:"page"},private_chat:{title:"Private Chat",type:"page"},group_chat:{title:"Group Chat",type:"page"},presence:"Presence"}},{kind:"MdxPage",name:"authentication",route:"/protocol/authentication"},{kind:"MdxPage",name:"group_chat",route:"/protocol/group_chat"},{kind:"MdxPage",name:"index",route:"/protocol"},{kind:"MdxPage",name:"presence",route:"/protocol/presence"},{kind:"MdxPage",name:"private_chat",route:"/protocol/private_chat"}]},{kind:"MdxPage",name:"sequence",route:"/sequence"},{kind:"Folder",name:"sequences",route:"/sequences",children:[{kind:"MdxPage",name:"authentication",route:"/sequences/authentication"},{kind:"MdxPage",name:"group_chat",route:"/sequences/group_chat"},{kind:"MdxPage",name:"presence",route:"/sequences/presence"},{kind:"MdxPage",name:"private_chat",route:"/sequences/private_chat"},{kind:"Meta",data:{authentication:"Authentication",group_chat:"Group Chat",presence:"Presence",private_chat:"Private Chat"}}]},{kind:"MdxPage",name:"stress-test",route:"/stress-test"},{kind:"MdxPage",name:"uml",route:"/uml"}],flexsearch:{codeblocks:!0},readingTime:{text:"0 min read",minutes:0,time:0,words:0},title:"Private Chat",headings:l},pageNextRoute:"/sequences/private_chat",nextraLayout:i.ZP,themeConfig:s.Z};r.default=(0,n.j)(p)},3209:function(e,r,t){"use strict";var a=t(5893),n=t(7656),i=t(1163);let s={logo:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(n.Z,{size:24,className:"mr-2"}),(0,a.jsx)("span",{className:"font-bold text-xl",children:"Whisper Chat"})]}),project:{link:"https://github.com/ukeSJTU/whisper"},docsRepositoryBase:"https://github.com/ukeSJTU/whisper-docs",footer:{text:(0,a.jsxs)("span",{children:["\xa9 ",new Date().getFullYear()," Whisper Chat. All rights reserved."]})},useNextSeoProps(){let{asPath:e}=(0,i.useRouter)();return{titleTemplate:"/"!==e?"%s – Whisper Chat":"Whisper Chat - Secure Real-Time Communication",description:"Whisper is a modern, secure web-based chat application for real-time communication."}},head:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,a.jsx)("meta",{name:"description",content:"Whisper is a modern, secure web-based chat application for real-time communication."}),(0,a.jsx)("meta",{name:"og:title",content:"Whisper Chat"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),banner:{key:"whisper-release",text:(0,a.jsxs)("span",{children:["\uD83C\uDF89 Try Whisper Chat online →"," ",(0,a.jsx)("a",{href:"https://whisper.ukehome.top",children:"whisper"})]})},primaryHue:{dark:260,light:180},navigation:{prev:!0,next:!0},darkMode:!0,nextThemes:{defaultTheme:"system"}};r.Z=s},5789:function(){},8757:function(e,r,t){"use strict";t.d(r,{G:function(){return s}});var a=t(5893),n=t(7294),i=t(7541);function s({chart:e}){let r=(0,n.useId)(),[t,s]=(0,n.useState)("");return(0,n.useEffect)(()=>{let t=document.documentElement,a=new MutationObserver(n);return a.observe(t,{attributes:!0}),n(),()=>{a.disconnect()};async function n(){let a=t.classList.contains("dark")||t.attributes.getNamedItem("data-theme")?.value==="dark";try{i.N.initialize({startOnLoad:!1,securityLevel:"loose",fontFamily:"inherit",themeCSS:"margin: 1.5rem auto 0;",theme:a?"dark":"default"});let{svg:t}=await i.N.render(r.replaceAll(":",""),e);s(t)}catch(e){console.error("Error while rendering mermaid",e)}}},[e]),(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})}}},function(e){e.O(0,[7163,2114,3542,2888,9774,179],function(){return e(e.s=3785)}),_N_E=e.O()}]);